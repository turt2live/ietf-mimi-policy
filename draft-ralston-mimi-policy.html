<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>MIMI Policy Envelope</title>
<meta content="Travis Ralston" name="author">
<meta content="Matthew Hodgson" name="author">
<meta content="
       The MIMI Policy Envelope describes a  policy control protocol  and
 participation control protocol  for use in a room, applied at the user
participation level, as described by  . 
    " name="description">
<meta content="xml2rfc 3.18.0" name="generator">
<meta content="mimi" name="keyword">
<meta content="policy" name="keyword">
<meta content="envelope" name="keyword">
<meta content="messaging" name="keyword">
<meta content="draft-ralston-mimi-policy-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.0
    Python 3.11.5
    ConfigArgParse 1.5.3
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 3.10.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.6
-->
<link href="draft-ralston-mimi-policy.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MIMI Policy Envelope</td>
<td class="right">September 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Ralston &amp; Hodgson</td>
<td class="center">Expires 24 March 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">More Instant Messaging Interoperability</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ralston-mimi-policy-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-09-21" class="published">21 September 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-03-24">24 March 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Ralston</div>
<div class="org">The Matrix.org Foundation C.I.C.</div>
</div>
<div class="author">
      <div class="author-name">M. Hodgson</div>
<div class="org">The Matrix.org Foundation C.I.C.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">MIMI Policy Envelope</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The MIMI Policy Envelope describes a <em>policy control protocol</em> and
<em>participation control protocol</em> for use in a room, applied at the user
participation level, as described by <span>[<a href="#I-D.barnes-mimi-arch" class="cite xref">I-D.barnes-mimi-arch</a>]</span>.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://turt2live.github.io/ietf-mimi-policy/draft-ralston-mimi-policy.html">https://turt2live.github.io/ietf-mimi-policy/draft-ralston-mimi-policy.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ralston-mimi-policy/">https://datatracker.ietf.org/doc/draft-ralston-mimi-policy/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        More Instant Messaging Interoperability Working Group mailing list (<span><a href="mailto:mimi@ietf.org">mailto:mimi@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/mimi/">https://mailarchive.ietf.org/arch/browse/mimi/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/mimi/">https://www.ietf.org/mailman/listinfo/mimi/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/turt2live/ietf-mimi-policy">https://github.com/turt2live/ietf-mimi-policy</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 24 March 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-permissions-definitions" class="internal xref">Permissions Definitions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-participation-definitions" class="internal xref">Participation Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-event-authorization" class="internal xref">Event Authorization</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-auth-events-selection" class="internal xref">Auth Events Selection</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-types-of-senders" class="internal xref">Types of Senders</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-permissions" class="internal xref">Permissions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-calculating-permissions" class="internal xref">Calculating Permissions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-effective-power-level" class="internal xref">Effective Power Level</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-list-of-permissions" class="internal xref">List of Permissions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-event-sending-permissions" class="internal xref">Event Sending Permissions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-role-changes" class="internal xref">Role Changes</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-user-participation" class="internal xref">User Participation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-general-conditions" class="internal xref">General Conditions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-invite-conditions" class="internal xref">Invite Conditions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-join-conditions" class="internal xref">Join Conditions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="auto internal xref">6.4</a>.  <a href="#name-knock-conditions" class="internal xref">Knock Conditions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="auto internal xref">6.5</a>.  <a href="#name-ban-conditions" class="internal xref">Ban Conditions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="auto internal xref">6.6</a>.  <a href="#name-leave-conditions" class="internal xref">Leave Conditions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6.2.1">
                    <p id="section-toc.1-1.6.2.6.2.1.1"><a href="#section-6.6.1" class="auto internal xref">6.6.1</a>.  <a href="#name-voluntary" class="internal xref">Voluntary</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6.2.2">
                    <p id="section-toc.1-1.6.2.6.2.2.1"><a href="#section-6.6.2" class="auto internal xref">6.6.2</a>.  <a href="#name-kicks" class="internal xref">Kicks</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="auto internal xref">6.7</a>.  <a href="#name-mroomjoin_rules" class="internal xref"><code>m.room.join_rules</code></a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-event-history-visibility" class="internal xref">Event/History Visibility</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-mroomhistory_visibility" class="internal xref"><code>m.room.history_visibility</code></a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The primary objective for the More Instant Messaging Interoperability (MIMI)
working group is to specify the needed protocols to achieve interoperability
among modern messaging providers. The protocols which make up the "MIMI stack"
are described by <span>[<a href="#I-D.barnes-mimi-arch" class="cite xref">I-D.barnes-mimi-arch</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">In the stack are a policy control protocol and a participation control protocol.
These two control protocols are described by this document, supported by
<strong>TODO(TR): Link to I-D.ralston-mimi-signaling</strong>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Policy control is handled through permissions, while participation is managed
primarily through the rules governing <code>m.room.user</code>. Together, these control
protocols create this policy document.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">When an action is impossible for a server to enforce, such as when a client
operated by a user sends an encrypted instant message, the receiving clients
are responsible for enforcing the remainder of the policy. This may mean, for
example, decrypting a message but not rendering it due to a policy violation.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">The concepts of permissions and participation state for a user are deliberately
separated in this policy document. A user's participation state might affect
which permissions they can use, but a user's permissions do not change their
participation in a room.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Terms from <span>[<a href="#I-D.barnes-mimi-arch" class="cite xref">I-D.barnes-mimi-arch</a>]</span> and <span>[<a href="#I-D.ralston-mimi-terminology" class="cite xref">I-D.ralston-mimi-terminology</a>]</span> are
used throughout this document. <span>[<a href="#I-D.barnes-mimi-arch" class="cite xref">I-D.barnes-mimi-arch</a>]</span> takes precedence where
there's conflict.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">Terms from <strong>TODO(TR): Link to I-D.ralston-mimi-signaling</strong> are used throughout
this document.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Other terms include:<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5"><em>Rejected</em>: The action being performed ceases to continue through the remainder
of the send/rendering steps. For a hub server, this means the event being sent
is not added to the room and is not sent to any other server. For a client, this
equates to not rendering or respecting the action.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6"><em>Allowed</em>: The opposite of Rejected. The action is expressly permitted to occur.<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7"><em>"Engaging with the room"</em>: The user is able to take some actions and send
messages in the room, provided the remainder of the policy allows them to do
that. The encryption/security layer <span class="bcp14">MAY</span> further restrict a user's ability to
take action. For example, the user might need 1 or more clients to be able to
successfully send a message.<a href="#section-2-7" class="pilcrow">¶</a></p>
<div id="permissions-definitions">
<section id="section-2.1">
        <h3 id="name-permissions-definitions">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-permissions-definitions" class="section-name selfRef">Permissions Definitions</a>
        </h3>
<p id="section-2.1-1"><em>Action</em>: Something a user does in the context of a room. For example, invite
another user or send a message to the room.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2"><em>Permission</em>: A flag which allows (or rejects) execution of an action.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3"><em>Role</em>: A user-defined set of permissions. Users are added to roles to gain the
included permissions.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="participation-definitions">
<section id="section-2.2">
        <h3 id="name-participation-definitions">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-participation-definitions" class="section-name selfRef">Participation Definitions</a>
        </h3>
<p id="section-2.2-1"><em>Target</em>: The user affected by a participation state.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2"><em>Sender</em>: The user affecting a target user with a participation state.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3"><em>Invited</em>: The target is given the choice to accept the invite (join the room)
or decline (leave the room).<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4"><em>Joined</em>: The target is capable of engaging with the room.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5"><em>Left</em>: The target has either voluntarily chosen to leave the room, or has been
removed with a kick.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6"><em>Banned</em>: The target is kicked and cannot be invited, joined, or knock on the
room until unbanned.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
<p id="section-2.2-7"><em>Knocking</em>: The sender is requesting an invite into the room. They can either
be welcomed in (invited) or declined (kicked).<a href="#section-2.2-7" class="pilcrow">¶</a></p>
<p id="section-2.2-8"><em>Kicked</em>: Involuntary leave. The target and sender are not the same user.<a href="#section-2.2-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="event-authorization">
<section id="section-3">
      <h2 id="name-event-authorization">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-event-authorization" class="section-name selfRef">Event Authorization</a>
      </h2>
<p id="section-3-1">When a hub server receives an event, and before it adds it to the room, it <span class="bcp14">MUST</span>
ensure the event passes the policy for the room. In the case of this document,
the server <span class="bcp14">MUST</span> ensure the following checks are performed:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">The event is correctly signed and hashed.<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.2">The event's <code>authEvents</code> include the appropriate event types
(<a href="#int-auth-selection" class="auto internal xref">Section 3.1</a>).<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.3">The <code>sender</code> has permission (<a href="#int-calc-permissions" class="auto internal xref">Section 5.1</a>) to send the event.<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.4">Any event type-specific checks are performed, as described throughout this
document.<a href="#section-3-2.4" class="pilcrow">¶</a>
</li>
      </ol>
<div id="int-auth-selection">
<section id="section-3.1">
        <h3 id="name-auth-events-selection">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-auth-events-selection" class="section-name selfRef">Auth Events Selection</a>
        </h3>
<p id="section-3.1-1">When a server is populating <code>authEvents</code>, it <span class="bcp14">MUST</span> include the event IDs for the
following event types. These <span class="bcp14">SHOULD</span> be the most recent event IDs for the event
types.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Note: <code>m.room.create</code> <span class="bcp14">MUST</span> always have an empty <code>authEvents</code> array.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-3.1">The <code>m.room.create</code> event.<a href="#section-3.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.2">The <code>m.room.user</code> event for the <code>sender</code>, if applicable.<a href="#section-3.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.3">The <code>m.room.role_map</code> event (<a href="#int-permissions" class="auto internal xref">Section 5</a>), if set.<a href="#section-3.1-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.4">The <code>m.room.role</code> events (<a href="#int-permissions" class="auto internal xref">Section 5</a>) assigned to the user <code>sender</code>,
if any.<a href="#section-3.1-3.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.5">
            <p id="section-3.1-3.5.1">If the event type is <code>m.room.user</code>:<a href="#section-3.1-3.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-3.5.2.1">The target user's <code>m.room.user</code> event, if any.<a href="#section-3.1-3.5.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-3.1-3.5.2.2">If the <code>participation</code> state is <code>join</code> or <code>invite</code>, the <code>m.room.join_rules</code>
event (<a href="#int-ev-join-rules" class="auto internal xref">Section 6.7</a>), if any.<a href="#section-3.1-3.5.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-3.1-4"><strong>TODO(TR): Restricted joins join_authorised_via_users_server?
(<a href="https://github.com/turt2live/ietf-mimi-policy/issues/1">GH issue</a>)</strong><a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5">If an event is missing from <code>authEvents</code> but should have been included with the
above selection algorithm, the event is rejected.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">If events not intended to be selected using the above algorithm above are
included in <code>authEvents</code>, the event is rejected. This extends to events which
aren't known or are malformed in <code>authEvents</code>.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7">If an event uses non-current events in its <code>authEvents</code>, it is rejected.<a href="#section-3.1-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="types-of-senders">
<section id="section-4">
      <h2 id="name-types-of-senders">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-types-of-senders" class="section-name selfRef">Types of Senders</a>
      </h2>
<p id="section-4-1"><strong>TODO(TR): Do we want to send as not-users?
(<a href="https://github.com/turt2live/ietf-mimi-policy/issues/2">GH issue</a>)</strong><a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Currently this document only supports <code>sender</code> being a user ID.<a href="#section-4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="int-permissions">
<section id="section-5">
      <h2 id="name-permissions">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-permissions" class="section-name selfRef">Permissions</a>
      </h2>
<p id="section-5-1">Rooms are capable of defining their own roles for grouping permissions to apply
to users. These roles do not currently have aesthetic characteristics, such as
a display name, badge color, or avatar.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Roles are described by an <code>m.room.role</code> state event. The state key for the event
is the "role ID", and is not intended to be human readable.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The content for the event has the following structure in TLS presentation
language format (<span><a href="https://rfc-editor.org/rfc/rfc8446#section-3" class="relref">Section 3</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>):<a href="#section-5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-4">
<pre>
enum {
   // Iterated later in the document.
} Permission;

struct {
   select (Permission) {
      // cases defined later in the document.
   } permission;
} PermissionValue;

struct {
   PermissionValue permissions[];
} MRoomRoleEventContent;
</pre><a href="#section-5-4" class="pilcrow">¶</a>
</div>
<p id="section-5-5">Users are assigned to roles using an <code>m.room.role_map</code> state event, with empty
string for a state key. The content being as follows:<a href="#section-5-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-6">
<pre>
struct {
   // The role's ID.
   opaque roleId;

   // The user IDs who are assigned this role.
   opaque userIds[];

   // The power level for the role. This is used in cases of tiebreak and to
   // override permissions from another role.
   uint32 order;
} RoleConfig;

struct {
   RoleConfig roles[];
} MRoomRoleMapEventContent;
</pre><a href="#section-5-6" class="pilcrow">¶</a>
</div>
<p id="section-5-7">Each role ID <span class="bcp14">MUST</span> only appear once in <code>MRoomRoleMapEventContent.roles</code>. Each
<code>RoleConfig.order</code> <span class="bcp14">MUST</span> be distinct from all other entries. If either of these
checks fail when a server receives the event, the event is rejected.<a href="#section-5-7" class="pilcrow">¶</a></p>
<div id="int-calc-permissions">
<section id="section-5.1">
        <h3 id="name-calculating-permissions">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-calculating-permissions" class="section-name selfRef">Calculating Permissions</a>
        </h3>
<p id="section-5.1-1">A user's permissions is the sum of the permissions described by their assigned
roles. When two roles define the same permission (but with different values),
the higher <code>order</code> role takes precedence.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">For example, if given the following role structure...<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-3.1">
            <p id="section-5.1-3.1.1">Role A, order 1.<a href="#section-5.1-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-3.1.2.1">Permission A = true<a href="#section-5.1-3.1.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-5.1-3.1.2.2">Permission B = false<a href="#section-5.1-3.1.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.1-3.2">
            <p id="section-5.1-3.2.1">Role B, order 2.<a href="#section-5.1-3.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-3.2.2.1">Permission A = false<a href="#section-5.1-3.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-5.1-3.2.2.2">Permission C = false<a href="#section-5.1-3.2.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.1-3.3">
            <p id="section-5.1-3.3.1">Role C, order 3.<a href="#section-5.1-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-3.3.2.1">Permission B = true<a href="#section-5.1-3.3.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-5.1-3.3.2.2">Permission C = false<a href="#section-5.1-3.3.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-5.1-4">... and a user assigned all three roles, the user's resolved set of permissions
would be:<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-5.1">Permission A = false (takes Role B's value)<a href="#section-5.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-5.2">Permission B = true (takes Role C's value)<a href="#section-5.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-5.3">Permission C = false (defined by Role B, no conflict with Role C)<a href="#section-5.1-5.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-6">These permissions are then used to define whether a user can "send" the event.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="int-effective-power">
<section id="section-5.2">
        <h3 id="name-effective-power-level">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-effective-power-level" class="section-name selfRef">Effective Power Level</a>
        </h3>
<p id="section-5.2-1">In some cases it is required to know the "power level" for a user to solve
tiebreaks. The power level of a user is the highest <code>order</code> role they are
assigned with the desired permission set, regardless of value for that
permission.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Using the example from <a href="#int-calc-permissions" class="auto internal xref">Section 5.1</a>, a user with all three roles
would have the following effective power levels for each permission in question:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">Permission A = 2<a href="#section-5.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.2-3.2">Permission B = 3<a href="#section-5.2-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.2-3.3">Permission C = 3<a href="#section-5.2-3.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="list-of-permissions">
<section id="section-5.3">
        <h3 id="name-list-of-permissions">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-list-of-permissions" class="section-name selfRef">List of Permissions</a>
        </h3>
<p id="section-5.3-1">The full definitions for <code>Permission</code> and <code>PermissionValue</code> in
<a href="#int-permissions" class="auto internal xref">Section 5</a> is:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-2">
<pre>
enum {
   // Whether other users can be invited to the room by the role.
   // Default: false.
   invite(1),

   // Whether other users can be kicked from the room by the role.
   // Default: false.
   kick(2),

   // Whether other users can be banned from the room by the role.
   // Default: false.
   ban(3),

   // Whether another user's events can be redacted by the role.
   // Senders can always redact their own events regardless of this permission.
   // Default: false.
   redact(4), // TODO(TR): Do we need this one?

   // The event types the role is able to send.
   // Default: None.
   events(5),

   // The actions this role can take against roles. For example, adding or
   // removing permissions.
   // Default: None.
   roles(6),
} Permission;

struct {
   select (Permission) {
      case invite: BooleanPermission;
      case kick: BooleanPermission;
      case ban: BooleanPermission;
      case redact: BooleanPermission;
      case events: EventTypePermission;
      case roles: RolePermission;
   } permission;
} PermissionValue;

struct {
   // When false, the permission is explicitly not granted.
   byte granted;
} BooleanPermission;

struct {
   // The event type being gated by a permission.
   opaque eventType;

   // When false, the permission to send the event is explicitly not granted.
   byte granted;
} EventTypePermissionRecord;

struct {
   // The event type restrictions. If there are duplicates, the lastmost entry
   // takes priority.
   EventTypePermissionRecord eventTypes[];
} EventTypePermission;

struct {
   // The role IDs that can be affected by this role. This includes adding,
   // removing, and changing permissions.
   // TODO(TR): We might want something more comprehensive.
   opaque affectRoleId[];
} RolePermission;
</pre><a href="#section-5.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="event-sending-permissions">
<section id="section-5.4">
        <h3 id="name-event-sending-permissions">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-event-sending-permissions" class="section-name selfRef">Event Sending Permissions</a>
        </h3>
<p id="section-5.4-1">The <code>sender</code> for an event <span class="bcp14">MUST</span> have permission (<a href="#int-calc-permissions" class="auto internal xref">Section 5.1</a>) to
send that event type, unless the event type is <code>m.room.user</code>. User participation
events are handled specifically in <a href="#int-user-participation" class="auto internal xref">Section 6</a>.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">The <code>sender</code> <span class="bcp14">MUST</span> also be in the joined state to send such events.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="role-changes">
<section id="section-5.5">
        <h3 id="name-role-changes">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-role-changes" class="section-name selfRef">Role Changes</a>
        </h3>
<p id="section-5.5-1"><strong>TODO(TR): I believe we need words to describe how to use the role permissions
described above. Probably something using effective power levels and talking
about what "add", "remove", and "change" actually mean.</strong><a href="#section-5.5-1" class="pilcrow">¶</a></p>
<p id="section-5.5-2"><strong>TODO(TR): We also need to specify that the creator has superuser permissions
until a role is defined/assigned.</strong><a href="#section-5.5-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="int-user-participation">
<section id="section-6">
      <h2 id="name-user-participation">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-user-participation" class="section-name selfRef">User Participation</a>
      </h2>
<p id="section-6-1">User participation is tracked as <code>m.room.user</code> state events. The <code>content</code> for
such an event has the following structure in TLS presentation language format
(<span><a href="https://rfc-editor.org/rfc/rfc8446#section-3" class="relref">Section 3</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>):<a href="#section-6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6-2">
<pre>
enum {
   invite,  // "Invited" state.
   join,    // "Joined" state.
   leave,   // "Left" state (including Kicked).
   ban,     // "Banned" state.
   knock    // "Knocking" state.
} ParticipationState;

struct {
   ParticipationState participation;
   opaque reason;  // optional reason for the participation state
} MRoomUserEventContent;
</pre><a href="#section-6-2" class="pilcrow">¶</a>
</div>
<p id="section-6-3">A user is considered to be "joined" to a room if they have a participation state
of <code>join</code>. All servers with users in the joined state are considered to be "in"
the room.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Servers which are in the room can send events for their users directly. The
signaling protocol is able to assist servers (and therefore users) in sending
the appropriate participation events until they are able complete the join
process.<a href="#section-6-4" class="pilcrow">¶</a></p>
<div id="general-conditions">
<section id="section-6.1">
        <h3 id="name-general-conditions">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-general-conditions" class="section-name selfRef">General Conditions</a>
        </h3>
<p id="section-6.1-1"><strong>TODO(TR): This is where we'd put server ACLs.
(<a href="https://github.com/turt2live/ietf-mimi-policy/issues/3">GH issue</a>)</strong><a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="invite-conditions">
<section id="section-6.2">
        <h3 id="name-invite-conditions">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-invite-conditions" class="section-name selfRef">Invite Conditions</a>
        </h3>
<p id="section-6.2-1">The target user for an invite <span class="bcp14">MUST</span>:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-2.1">NOT already be in the banned state.<a href="#section-6.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-2.2">NOT already be in the joined state.<a href="#section-6.2-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.2-3">The sender for an invite <span class="bcp14">MUST</span>:<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-4.1">Already be in the joined state.<a href="#section-6.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-4.2">Have permission (<a href="#int-calc-permissions" class="auto internal xref">Section 5.1</a>) to invite users.<a href="#section-6.2-4.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.2-5">Otherwise, reject.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="join-conditions">
<section id="section-6.3">
        <h3 id="name-join-conditions">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-join-conditions" class="section-name selfRef">Join Conditions</a>
        </h3>
<p id="section-6.3-1">The target and sender of a join <span class="bcp14">MUST</span> be the same.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">Whether a user can join without invite is dependent on the join rules
(<a href="#int-ev-join-rules" class="auto internal xref">Section 6.7</a>).<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">If the join rule is <code>invite</code> or <code>knock</code>, the user <span class="bcp14">MUST</span> already be in the joined
or invite state.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">If the join rule is <code>public</code>, the user <span class="bcp14">MUST NOT</span> already be in the banned state.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
<p id="section-6.3-5">Otherwise, reject.<a href="#section-6.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="knock-conditions">
<section id="section-6.4">
        <h3 id="name-knock-conditions">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-knock-conditions" class="section-name selfRef">Knock Conditions</a>
        </h3>
<p id="section-6.4-1">The target and sender of a knock <span class="bcp14">MUST</span> be the same.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">If the current join rule (<a href="#int-ev-join-rules" class="auto internal xref">Section 6.7</a>) for the room is <code>knock</code>, the
user <span class="bcp14">MUST NOT</span> already be in the banned or joined state.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<p id="section-6.4-3">Otherwise, reject.<a href="#section-6.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ban-conditions">
<section id="section-6.5">
        <h3 id="name-ban-conditions">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-ban-conditions" class="section-name selfRef">Ban Conditions</a>
        </h3>
<p id="section-6.5-1">The sender for a ban <span class="bcp14">MUST</span>:<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.5-2.1">Already be in the joined state.<a href="#section-6.5-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.5-2.2">Have permission (<a href="#int-calc-permissions" class="auto internal xref">Section 5.1</a>) to ban users.<a href="#section-6.5-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.5-3">Otherwise, reject.<a href="#section-6.5-3" class="pilcrow">¶</a></p>
<p id="section-6.5-4">Note that a ban implies kick.<a href="#section-6.5-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="leave-conditions">
<section id="section-6.6">
        <h3 id="name-leave-conditions">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-leave-conditions" class="section-name selfRef">Leave Conditions</a>
        </h3>
<p id="section-6.6-1">Leaves in a room come in two varieties: voluntary and kicks. Voluntary leaves
are when the user no longer wishes to be an active participant in the room. A
kick is done to remove a user forcefully.<a href="#section-6.6-1" class="pilcrow">¶</a></p>
<p id="section-6.6-2">When the target and sender of a leave is the same, it is a voluntary leave.<a href="#section-6.6-2" class="pilcrow">¶</a></p>
<div id="voluntary">
<section id="section-6.6.1">
          <h4 id="name-voluntary">
<a href="#section-6.6.1" class="section-number selfRef">6.6.1. </a><a href="#name-voluntary" class="section-name selfRef">Voluntary</a>
          </h4>
<p id="section-6.6.1-1">The user <span class="bcp14">MUST</span> be in the invited, joined, or knocking state.<a href="#section-6.6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.6.1-2">Otherwise, reject.<a href="#section-6.6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="kicks">
<section id="section-6.6.2">
          <h4 id="name-kicks">
<a href="#section-6.6.2" class="section-number selfRef">6.6.2. </a><a href="#name-kicks" class="section-name selfRef">Kicks</a>
          </h4>
<p id="section-6.6.2-1">The target user for a kick <span class="bcp14">MUST</span>:<a href="#section-6.6.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.6.2-2.1">Already be in the joined state.<a href="#section-6.6.2-2.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-6.6.2-3">The sender for a kick <span class="bcp14">MUST</span>:<a href="#section-6.6.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.6.2-4.1">Already be in the joined state.<a href="#section-6.6.2-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.6.2-4.2">Have permission (<a href="#int-calc-permissions" class="auto internal xref">Section 5.1</a>) to kick users.<a href="#section-6.6.2-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.6.2-4.3">Have a higher (and NOT equal to) effective power level with respect to the
kick permission (<a href="#int-effective-power" class="auto internal xref">Section 5.2</a>) than the target user.<a href="#section-6.6.2-4.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-6.6.2-5">If the target user is in the banned state, the sender requires permission to
ban users instead (as to ban means to unban as well). This additionally extends
to the effective power level check.<a href="#section-6.6.2-5" class="pilcrow">¶</a></p>
<p id="section-6.6.2-6">Otherwise, reject.<a href="#section-6.6.2-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="int-ev-join-rules">
<section id="section-6.7">
        <h3 id="name-mroomjoin_rules">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-mroomjoin_rules" class="section-name selfRef"><code>m.room.join_rules</code></a>
        </h3>
<p id="section-6.7-1"><strong>State key</strong>: Empty string.<a href="#section-6.7-1" class="pilcrow">¶</a></p>
<p id="section-6.7-2"><strong>Content</strong>:<a href="#section-6.7-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.7-3">
<pre>
enum {
   invite,
   knock,
   public,
} JoinRule;

struct {
  // The current join rule for the room. Defaults to `invite` if no join rules
  // event is in the room.
  JoinRule rule;
} MRoomJoinRulesEventContent;
</pre><a href="#section-6.7-3" class="pilcrow">¶</a>
</div>
<p id="section-6.7-4"><strong>Redaction considerations</strong>: <code>rule</code> under <code>content</code> is protected from
redaction.<a href="#section-6.7-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="eventhistory-visibility">
<section id="section-7">
      <h2 id="name-event-history-visibility">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-event-history-visibility" class="section-name selfRef">Event/History Visibility</a>
      </h2>
<p id="section-7-1">Unless otherwise specified by the event type, non-state events <span class="bcp14">MUST NOT</span> be sent
to a user's client if the history visibility rules prohibit it. State events
are always visible to clients.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">When a server is fetching events it is missing to build history, the returned
events are redacted unless the server has at least one user which is able to
see the event under the history visibility rules. The server must then further
filter the events before sending them to clients.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">History visibility rules are defined by <code>m.room.history_visibility</code>
(<a href="#int-ev-history-viz" class="auto internal xref">Section 7.1</a>), and can only affect future events. Events sent before
the history visibility rule change are not retroactively affected.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">Taking into consideration the <code>m.room.history_visibility</code> event that is current
at the time an event was sent, a user's visibility of a that event is described
as:<a href="#section-7-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-5.1">If the visibility rule was <code>world</code>, show.<a href="#section-7-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-5.2">If the user was in the joined state, show.<a href="#section-7-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-5.3">If the visibility rule was <code>shared</code> and the user was in the joined state at
any point after the event was sent, show.<a href="#section-7-5.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-5.4">If the user was in the invited state, and the visibility rule was <code>invited</code>,
show.<a href="#section-7-5.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-5.5">Otherwise, don't show.<a href="#section-7-5.5" class="pilcrow">¶</a>
</li>
      </ul>
<div id="int-ev-history-viz">
<section id="section-7.1">
        <h3 id="name-mroomhistory_visibility">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-mroomhistory_visibility" class="section-name selfRef"><code>m.room.history_visibility</code></a>
        </h3>
<p id="section-7.1-1"><strong>State key</strong>: Empty string.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2"><strong>Content</strong>:<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-3">
<pre>
enum {
   invited,
   joined,
   shared,
   world,
} Visibility;

struct {
  // The current join rule for the room. Defaults to `shared` if no history
  // visibility event is present in the room.
  Visibility visibility;
} MRoomHistoryVisibilityEventContent;
</pre><a href="#section-7.1-3" class="pilcrow">¶</a>
</div>
<p id="section-7.1-4"><strong>Redaction considerations</strong>: <code>visibility</code> under <code>content</code> is protected from
redaction.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document as a whole makes up the <code>m.0</code> policy ID, as per
<strong>TODO(TR): Link to I-D.ralston-mimi-signaling</strong>.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">This document's descriptions for the following event types are registered to the
event types registry in <strong>TODO(TR): Link to I-D.ralston-mimi-signaling</strong>:<a href="#section-8-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-3.1">
          <code>m.room.role</code> (<a href="#int-permissions" class="auto internal xref">Section 5</a>)<a href="#section-8-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-3.2">
          <code>m.room.role_map</code> (<a href="#int-permissions" class="auto internal xref">Section 5</a>)<a href="#section-8-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-3.3">
          <code>m.room.join_rules</code> (<a href="#int-ev-join-rules" class="auto internal xref">Section 6.7</a>)<a href="#section-8-3.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-3.4">
          <code>m.room.history_visibility</code> (<a href="#int-ev-history-viz" class="auto internal xref">Section 7.1</a>)<a href="#section-8-3.4" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.barnes-mimi-arch">[I-D.barnes-mimi-arch]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refTitle">"An Architecture for More Instant Messaging Interoperability (MIMI)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-barnes-mimi-arch-00</span>, <time datetime="2023-08-29" class="refDate">29 August 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-barnes-mimi-arch-00">https://datatracker.ietf.org/doc/html/draft-barnes-mimi-arch-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ralston-mimi-terminology">[I-D.ralston-mimi-terminology]</dt>
        <dd>
<span class="refAuthor">Ralston, T.</span>, <span class="refTitle">"MIMI Terminology"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ralston-mimi-terminology-02</span>, <time datetime="2023-07-10" class="refDate">10 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ralston-mimi-terminology-02">https://datatracker.ietf.org/doc/html/draft-ralston-mimi-terminology-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC8446">[RFC8446]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Travis Ralston</span></div>
<div dir="auto" class="left"><span class="org">The Matrix.org Foundation C.I.C.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:travisr@matrix.org" class="email">travisr@matrix.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Matthew Hodgson</span></div>
<div dir="auto" class="left"><span class="org">The Matrix.org Foundation C.I.C.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:matthew@matrix.org" class="email">matthew@matrix.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
